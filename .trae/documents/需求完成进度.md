# 需求完成进度

## 总览（截至当前）
- 框架骨架：后端 Minimal API、路由与仿真服务完成；前端容器与导航完成（≈100%）
- ST 解析与编译接口：变量域/行号、未声明引用检查，支持多行注释去除（≈85%）
  - 简单赋值类型检查（标识符/字面量）：TypeMismatch 诊断（+2%）
  - 表达式类型推断（数值/布尔/TIME 简化规则）：TypeMismatch 诊断（+1%）
  - 诊断标准化：新增 code/column 输出，前端标记与列表显示增强（+2%）
- FBD 画布与持久化：节点/连线/撤销重做/变量绑定/保存加载（≈80%）
- PLCopen XML：POU/工程导出、FBD 网络导出/导入（基础）完成（≈70%）
- 前端 ST 编辑器：高亮、编译诊断标记、悬浮提示（含域/行号）、跳转/重命名/查找引用、自动加载当前 POU ST（≈88%）
  - 前端后端地址统一配置，环境变量支持（+1%）
- 构建面板：编辑器与当前 POU 编译、工程编译汇总与导出，支持一键跳转到 ST（≈75%）
  - 新增严重级筛选（All/Error/Warning/Info），便捷筛选问题（+2%）
  - 聚合问题列表视图，统一浏览并跳转（+2%）
  - 列表项点击自动定位到行列（跨视图联动）（+1%）
  - 工程问题项可点击跳转至 ST 编辑器对应 POU（+2%）
- Electron 打包与自包含 .NET：未接入（≈10%）
- CI/CD（多平台构建/测试矩阵）：未接入（≈10%）

## 分项进度
### M1 骨架
- 后端 Minimal API + CORS + 仿真服务：已完成
- 前端 Vite+TS 项目、Monaco/React Flow 集成：已完成
- POU 管理与变量管理：创建/删除/变量定义/地址校验：已完成
- 工程保存/加载（JSON）与 XML 导出：已完成

### ST 支持
- 解析覆盖：`PROGRAM`、变量区（`VAR`/`VAR_INPUT`/`VAR_OUTPUT`/`VAR_IN_OUT`/`VAR_TEMP`）、赋值与未声明引用检查：已完成（基础）
- 语言服务：跳转定义、查找引用、重命名、悬浮类型与域、诊断标记：原型完成
- 类型系统与表达式/控制流完整覆盖：进行中（强化中）

### FBD 支持
- 画布交互：拖拽库块、端口连线、撤销/重做、参数编辑、端口绑定：已完成（基础）
- 语义验证：连线方向与类型一致性、简单拓扑排序：已完成（基础）
- FBD ↔ PLCopen：网络导出/导入：已完成（基础）

### IR 与执行模型
- 统一 IR/类型元数据：占位与最小映射：进行中
- 执行模型：拓扑排序输出与仿真接入：进行中

### 编译与仿真
- 编译管线（最小）：ST→诊断接口、POU/工程编译端点：已完成（基础）
- 仿真：变量快照与周期定时；未接入 FBD 执行：进行中

### PLCopen XML 导入/导出
- POU/工程导出（含 `inputVars`/`outputVars`/`inOutVars`/`localVars`）：已完成
- FBD Body 导出/导入：已完成（基础）
- XSD 校验与互导金样验证：待接入

### 前端 UI
- 项目树/POU 管理/变量管理：完成
- ST 编辑器：编译、诊断、悬浮、导航、重命名、引用高亮：完成（原型）
- FBD 编辑器：库/连线/属性/绑定：完成（原型）
- 构建面板：编辑器/POU/工程编译与导出：完成（原型）

## 里程碑预估
- M1 完成度：≈88%
- M2 完成度：≈40–50%
- M3 完成度：≈20–30%

## 架构与模式（要求）
- 后端：分层/整洁架构，端口-适配器，轻量 CQRS，依赖反转（DI）
- 前端：按功能域组织，视图/服务/模型分层，轻量状态容器（建议引入）
- 模式：Visitor/Builder/Strategy/Factory（解析与编译）；Command/Observer/Adapter（FBD 与 LSP）
- 横切：结构化日志、统一诊断结构、集中配置、金样测试与 XSD 校验、安全约束

## 近期优先事项
- 扩展 ST 语法与类型规则，提升 LSP 精度与作用域约束
- FBD 合法性检查与执行拓扑标准化输出并接入仿真
- 构建面板统一“问题列表”，支持跳转到 ST/FBD 具体位置
- 接入 XSD 校验与与主流工具的金样互导比对
- 引入状态容器与服务抽象，降低前端跨模块耦合
